<p>We are going to implement chain replication! The paper makes it sound so simple, right? Specifically, you will implement a replica that will form part of a chain replication chain. You will need to deal with links (replicas) going away and new links arriving. Because your replica may be the head or the tail, you will need to talk with clients.</p>
<p>The service we are providing to clients will be an incrementable hashtable. It is a hashtable whose key is a string and value is an integer. We cannot directly set the integer for a given key, but we can increment it. (We decrement by incrementing with a negative number.) If a key does not exist in the table, we act as if the key has a value of zero. the Two operations we can do on the table are:</p>
<ul>
<li><strong>get(key)</strong> - returns the current integer for the key, or zero if the key does not exist.</li>
<li><strong>increment(key, value)</strong> - increments the key by the given value.</li>
</ul>
<p>Since our implementations must interoperate, we will use gRPC with the proto file specified in <span class="ally-file-link-holder link_holder"><span class="instructure_file_holder link_holder instructure_file_link_holder"><a id="72316674" class="inline_disabled" title="Link" href="https://github.com/prayuj/chain-replication/blob/main/src/main/proto/chain.proto" target="_blank" data-api-endpoint="https://sjsu.instructure.com/api/v1/courses/1557174/files/72352997" data-api-returntype="File" data-id="72352997">chain.proto</a><a class="file_download_btn" role="button" download="" style="margin-inline-start: 5px; text-decoration: none;" href="https://sjsu.instructure.com/courses/1557174/files/72352997/download?download_frd=1" data-id="72352997"><span role="presentation"><svg viewBox="0 0 1920 1920" version="1.1" xmlns="http://www.w3.org/2000/svg" style="width:1em; height:1em; vertical-align:middle; fill:currentColor">
    <path d="M1807.09271,1482.47718 L1886.82918,1562.43953 L1531.51624,1917.75247 L355.346824,1917.75247 L0.0338823529,1562.43953 L79.8832941,1482.47718 L402.104471,1804.81129 L1484.75859,1804.81129 L1807.09271,1482.47718 Z M997.677176,-0.0338823529 L997.677176,1166.98729 L1352.99012,811.674353 L1432.95247,891.523765 L941.093647,1383.15671 L449.460706,891.523765 L529.423059,811.674353 L884.736,1166.98729 L884.736,-0.0338823529 L997.677176,-0.0338823529 Z" stroke="none" stroke-width="1" fill-rule="evenodd"></path>
</svg>
</span></a></span></span>. You will also need to implement <span class="ally-file-link-holder link_holder"><span class="instructure_file_holder link_holder instructure_file_link_holder"><a id="72316678" class="inline_disabled" title="Link" href="https://github.com/prayuj/chain-replication/blob/main/src/main/proto/chain_debug.proto" target="_blank" data-api-endpoint="https://sjsu.instructure.com/api/v1/courses/1557174/files/72316678" data-api-returntype="File" data-id="72316678">chain_debug.proto</a><a class="file_download_btn" role="button" download="" style="margin-inline-start: 5px; text-decoration: none;" href="https://sjsu.instructure.com/courses/1557174/files/72316678/download?download_frd=1" data-id="72316678"><span role="presentation"><svg viewBox="0 0 1920 1920" version="1.1" xmlns="http://www.w3.org/2000/svg" style="width:1em; height:1em; vertical-align:middle; fill:currentColor">
    <path d="M1807.09271,1482.47718 L1886.82918,1562.43953 L1531.51624,1917.75247 L355.346824,1917.75247 L0.0338823529,1562.43953 L79.8832941,1482.47718 L402.104471,1804.81129 L1484.75859,1804.81129 L1807.09271,1482.47718 Z M997.677176,-0.0338823529 L997.677176,1166.98729 L1352.99012,811.674353 L1432.95247,891.523765 L941.093647,1383.15671 L449.460706,891.523765 L529.423059,811.674353 L884.736,1166.98729 L884.736,-0.0338823529 L997.677176,-0.0338823529 Z" stroke="none" stroke-width="1" fill-rule="evenodd"></path>
</svg>
</span></a></span></span> for testing purposes. Please use this <span class="ally-file-link-holder link_holder"><span class="instructure_file_holder link_holder instructure_file_link_holder"><a id="72243796" class="inline_disabled" href="https://github.com/prayuj/chain-replication/blob/main/pom.xml" target="_blank" data-api-endpoint="https://github.com/prayuj/chain-replication/tree/main/src/main/proto" data-api-returntype="File" data-id="72243796">pom.xml</a><a class="file_download_btn" role="button" download="" style="margin-inline-start: 5px; text-decoration: none;" href="https://sjsu.instructure.com/courses/1557174/files/72243796/download?download_frd=1" data-id="72243796"><span role="presentation"><svg viewBox="0 0 1920 1920" version="1.1" xmlns="http://www.w3.org/2000/svg" style="width:1em; height:1em; vertical-align:middle; fill:currentColor">
    <path d="M1807.09271,1482.47718 L1886.82918,1562.43953 L1531.51624,1917.75247 L355.346824,1917.75247 L0.0338823529,1562.43953 L79.8832941,1482.47718 L402.104471,1804.81129 L1484.75859,1804.81129 L1807.09271,1482.47718 Z M997.677176,-0.0338823529 L997.677176,1166.98729 L1352.99012,811.674353 L1432.95247,891.523765 L941.093647,1383.15671 L449.460706,891.523765 L529.423059,811.674353 L884.736,1166.98729 L884.736,-0.0338823529 L997.677176,-0.0338823529 Z" stroke="none" stroke-width="1" fill-rule="evenodd"></path>
</svg>
</span></a></span></span> to build your code.</p>
<p>ZooKeeper will be our oracle (master) to tell us what machines are available and who is the tail and who is the master. You can start ZooKeeper with this jar file <span class="ally-file-link-holder link_holder"><span class="instructure_file_holder link_holder instructure_file_link_holder"><a id="71921241" class="inline_disabled" title="Link" href="https://drive.google.com/file/d/1SOXY1pHT6C31nZT8SxohvZ03wXrJ6pdW/view?usp=drive_link" target="_blank" data-api-endpoint="https://sjsu.instructure.com/api/v1/courses/1557174/files/71921241" data-api-returntype="File" data-id="71921241">zookeeper-dev-fatjar.jar</a><a class="file_download_btn" role="button" download="" style="margin-inline-start: 5px; text-decoration: none;" href="https://sjsu.instructure.com/courses/1557174/files/71921241/download?download_frd=1" data-id="71921241"><span role="presentation"><svg viewBox="0 0 1920 1920" version="1.1" xmlns="http://www.w3.org/2000/svg" style="width:1em; height:1em; vertical-align:middle; fill:currentColor">
    <path d="M1807.09271,1482.47718 L1886.82918,1562.43953 L1531.51624,1917.75247 L355.346824,1917.75247 L0.0338823529,1562.43953 L79.8832941,1482.47718 L402.104471,1804.81129 L1484.75859,1804.81129 L1807.09271,1482.47718 Z M997.677176,-0.0338823529 L997.677176,1166.98729 L1352.99012,811.674353 L1432.95247,891.523765 L941.093647,1383.15671 L449.460706,891.523765 L529.423059,811.674353 L884.736,1166.98729 L884.736,-0.0338823529 L997.677176,-0.0338823529 Z" stroke="none" stroke-width="1" fill-rule="evenodd"></path>
</svg>
</span></a></span></span>:</p>
<pre>java -jar zookeeper-dev-fatjar.jar server 2181 datadir</pre>
<p>ZooKeeper will startup listening on port 2181 and storing data in the datadir. You can then access ZooKeeper with addr:2181 where addr is the address of the machine you started ZooKeeper on.</p>
<p>When your program is started, you will be passed two arguments (along with others below): <strong>zookeeper_host_port_list control_path</strong>.</p>
<p><strong>zookeeper_host_port_list </strong>should match the address:port of the machines running ZooKeeper. The <strong>control_path </strong>will specify a node in ZooKeeper where sequential nodes will be created to determine the chain's ordering. When a replica starts, it will create a sequential znode of the form: replica-XXXXX, where XXXXX is the sequence number. The replica with the lowest sequence number is the head, and the highest is the tail. Replicas should watch their predecessor's and successor's znodes for changes so that they can rebuild the chain if necessary and potentially start acting as the head or tail.</p>
<p>The znode will contain two lines: the first line is <strong>host:port</strong> of the gRPC for the replica. The next line will be your name.</p>
<p>Some details that we need to make clear to interoperate properly:</p>
<ul>
<li>a replica should only respond successfully to HeadChainReplica.increment if it is the head. A successful response is generated when a head receives the ACK for the xid that corresponds to the increment invocation. For example, if a client calls increment('A' by 5) on the head and 'A' is currently 2 and 57 was the last xid, The head will generate an update with key='A', newValue=7, and xid=58. The head will not respond back to the client until it receives an ACK for xid 58 from its successor.</li>
<li>the state maintained by each replica, the table of keys and values, will reflect the state of the system when all pending requests have been acked. In other words, the state will be updated when an UpdateRequest is received even if the xid has not yet been acked.</li>
<li>when a successor connects to a new predecessor, it will send its current state to it's predecessor. The predecessor will match the predecessor against what it has received from zookeeper. It will do a state transfer with all pending updates (called <em>sent </em>in the paper) and send its state if needed. Before it sends the sent list, the predecessor will acknowledge any UpdateRequests based on the lastAck received from the successor.</li>
<li>a replica will get the addresses for its successors and predecessors from ZooKeeper. It should watch for changes. They will happen.</li>
<li><span>when issuing gRPC calls, you should use a timeout of 3 seconds.</span></li>
</ul>
<h2>command line</h2>
<p>your program should take the following command line:</p>
<pre>java -jar chainreplication.jar your_name grpc_host_port zookeeper_host_port_list control_path</pre>
<p>the control_path will specify a node in zookeeper where sequential nodes will be created to determine the ordering of the chain. when a replica starts, it will create a sequential znode of the form: replica-XXXXX, where XXXXX is the sequence number. the replica with the lowest sequence number is the head and the highest is the tail. replicas should watch their predecessor's for changes so that they can rebuild the chain if necessary and potentially start acting as the head or tail.</p>
<p>the znode will contain two lines: the first line is host:port of the grpc for the replica. the next line will be your name.</p>
<p>i encourage you to test against each other's implementation, but <strong>do not share code!</strong><strong></strong></p>
<h2>test plan</h2>
<p>here is the test plan that we will use: <a href="https://github.com/prayuj/chain-replication/blob/main/chain%20replication%20test%20plan.txt" target="_blank" class="external" rel="noreferrer noopener"><span>https://github.com/prayuj/chain-replication/blob/main/chain%20replication%20test%20plan.txt</span><span class="external_link_icon" style="margin-inline-start: 5px; display: inline-block; text-indent: initial; " role="presentation"><svg viewBox="0 0 1920 1920" version="1.1" xmlns="http://www.w3.org/2000/svg" style="width:1em; height:1em; vertical-align:middle; fill:currentColor">
    <path d="M1226.66667,267 C1314.88,267 1386.66667,338.786667 1386.66667,427 L1386.66667,427 L1386.66667,853.666667 L1280,853.666667 L1280,693.666667 L106.666667,693.666667 L106.666667,1493.66667 C106.666667,1523 130.56,1547 160,1547 L160,1547 L1226.66667,1547 C1256.10667,1547 1280,1523 1280,1493.66667 L1280,1493.66667 L1280,1280.33333 L1386.66667,1280.33333 L1386.66667,1493.66667 C1386.66667,1581.88 1314.88,1653.66667 1226.66667,1653.66667 L1226.66667,1653.66667 L160,1653.66667 C71.7866667,1653.66667 0,1581.88 0,1493.66667 L0,1493.66667 L0,427 C0,338.786667 71.7866667,267 160,267 L160,267 Z M1584.37333,709.293333 L1904.37333,1029.29333 C1925.17333,1050.09333 1925.17333,1083.90667 1904.37333,1104.70667 L1904.37333,1104.70667 L1584.37333,1424.70667 L1508.96,1349.29333 L1737.86667,1120.38667 L906.613333,1120.38667 L906.613333,1013.72 L1737.86667,1013.72 L1508.96,784.706667 L1584.37333,709.293333 Z M1226.66667,373.666667 L160,373.666667 C130.56,373.666667 106.666667,397.666667 106.666667,427 L106.666667,427 L106.666667,587 L1280,587 L1280,427 C1280,397.666667 1256.10667,373.666667 1226.66667,373.666667 L1226.66667,373.666667 Z" stroke="none" stroke-width="1" fill-rule="evenodd"></path>
</svg>
</span></a></p>
